<!DOCTYPE html><html><html xmlns:th="http://www.w3.org/1999/xhtml"><head th:include="/common/head::html"></head><body class="skin-1"><div id="wrapper">    <nav class="navbar-default navbar-static-side" role="navigation" th:include="/common/nav::html">    </nav>    <div id="page-wrapper" class="gray-bg">        <div class="row border-bottom" th:include="/common/top::html">        </div>


<div class="wrapper wrapper-content width-100">


	<div class="ibox float-e-margins">
	    <div class="ibox-title">
	        <h5 >tran</h5>
	        <div class="ibox-tools">
	            <div class="action-buttons inline">
	                <a class="pink" data-rel="tooltip" title="添加" href="javascript:showModal();">
	                	<i class="ace-icon fa fa-plus-square-o bigger-130"></i>
	                </a>
	                &nbsp;&nbsp;
	                <a class="red" href="javascript:void(0)" onclick="deletes()" data-rel="tooltip" title="批量删除">
	                	<i class="ace-icon fa fa-trash-o bigger-130"></i>
	                </a>
	            </div>
	            &nbsp;&nbsp;
				<a class="red" href="javascript:void(0)" data-rel="tooltip" title="导出" onclick="exportTable()">
					<i class=" ace-icon fa fa-file-excel-o bigger-130"></i>
				</a>
				&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;

	        </div>
	        <div class="ibox-tools no-border" style="margin-top: -7px;">
				<div class="input-group" style="width: 200px; float: left;">
					<input type="text" id="condition" class="form-control search-query" placeholder="">
					<span class="input-group-btn">
						<a class="purple btn-sm no-padding-left" data-rel="tooltip" title="查询" href="javascript:void(0)" id="btnselect" style="line-height: 2.5">
							<i class="ace-icon fa fa-search icon-on-right bigger-110"></i>
						</a>
					</span>
				</div>
			</div>
	    </div>
	    <div class="ibox-content">
	        <div class="widget-main no-padding-left no-padding-right">
		        <table class="table table-striped table-hover" id="datatable" style="border-top: 0;">
		            <thead>
		                <tr>
		                    <th class="center">
		                        <label class="position-relative">
		                            <input type="checkbox" class="ace" />
		                            <span class="lbl"></span>
		                        </label>
		                    </th>
									<th class="center">	商品名称</th>
									<th class="center">	商品分类ID</th>
									<th class="center">	商品分类名称</th>
									<th class="center">	价格</th>
									<th class="center">	数量</th>
									<th class="center">	商品描述</th>
									<th class="center">	图片名称</th>
									<th class="center">	上架时间</th>
		                    <th>操作</th>
		                </tr>
		            </thead>
		        </table>
	        </div>
	    </div>
	</div>
</div>

		<div id="modal-form" class="modal fade" aria-hidden="true" style="display: none;">
			<div class="modal-dialog">
				<div class="modal-content animated bounceInTop">
					<div class="modal-header"></div>
					<div class="modal-body">
						<div class="row">
							<form role="form" id="validation-form" name="validation-form" class="form-horizontal">
								<input type="hidden" id="id" name="id">
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 商品名称： </label>
												<div class="col-sm-4">
													<input type="text" id="name" name="name" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 商品分类ID： </label>
												<div class="col-sm-4">
													<input type="text" id="catalog" name="catalog" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 商品分类名称： </label>
												<div class="col-sm-4">
													<input type="text" id="catalogName" name="catalogName" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 价格： </label>
												<div class="col-sm-4">
													<input type="text" id="price" name="price" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 数量： </label>
												<div class="col-sm-4">
													<input type="text" id="number" name="number" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 商品描述： </label>
												<div class="col-sm-4">
													<input type="text" id="description" name="description" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 图片名称： </label>
												<div class="col-sm-4">
													<input type="text" id="picture" name="picture" class="form-control" />
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-3 control-label no-padding-right"> 上架时间： </label>
												<div class="col-sm-4">
													<input type="text" id="releaseTime" name="releaseTime" class="form-control" />
												</div>
											</div>

								<div>
									<button class="btn btn-sm btn-white pull-right m-t-n-xs" type="button"
											data-dismiss="modal">
										<strong>取消</strong></button>
									<button class="btn btn-sm btn-primary pull-right m-t-n-xs" type="button"
											onclick="save()">
										<strong>确定</strong></button>
								</div>
							</form>
						</div>

					</div>
				</div>
			</div>
		</div>

<script type="text/javascript">
var datatable;
var validator;

$(function(){

	$("#condition , #typeid").bind("change", getdata);
	$("#btnselect").bind("click", getdata);

	datatable = $('#datatable').advancedDataTable({
         "sAjaxSource": '[[@{/}]]tran/Products/list.html',
         "aoColumns": [
             { "mDataProp": function(source, type, val){
                 	return '<label class="position-relative"><input type="checkbox" class="ace" /><span class="lbl"></span></label>';
             	},
                 "sClass" : "center"
             },
    {"mDataProp": "name"},
    {"mDataProp": "catalog"},
    {"mDataProp": "catalogName"},
    {"mDataProp": "price"},
    {"mDataProp": "number"},
    {"mDataProp": "description"},
    {"mDataProp": "picture"},
    {"mDataProp": "releaseTime"},
             {"mDataProp": function(source, type, val){
                 return '<div class="action-buttons">'
                     + '<button class="btn btn-primary btn-xs" data-rel="tooltip" title="编辑" href="javascript:void(0)" onclick="editRecord(this)" style="margin: 2px">修改</button>'
                     + '<button  class="btn btn-danger btn-xs" data-rel="tooltip" title="删除" href="javascript:void(0)" onclick="deletes(this)" style="margin: 2px"><i class="ace-icon fa fa-trash-o bigger-130"></i></button>'
                     + '</div>';
             }}
         ],
         "fnServerParams": function ( aoData ) {

         },
         "oLanguage": {
             "sUrl": "[[@{/}]]/static/js/plugins/dataTables/jquery.dataTables.lang.zh-CN.txt"
         }
     });

 validator=   $('#validation-form').validate({
        errorElement: 'div',
        errorClass: 'help-block',
        focusInvalid: false,
        rules: {
    name: {
        required: true,
            maxlength: 32
    },
    catalog: {
        required: true,
            maxlength: 32
    },
    catalogName: {
        required: true,
            maxlength: 32
    },
    price: {
        required: true,
            maxlength: 32
    },
    number: {
        required: true,
            maxlength: 32
    },
    description: {
        required: true,
            maxlength: 32
    },
    picture: {
        required: true,
            maxlength: 32
    },
    releaseTime: {
        required: true,
            maxlength: 32
    },
},
    messages: {
        name: {
            required: "请填商品名称",
                maxlength: "商品名称不能多余32个字符"
        },
        catalog: {
            required: "请填商品分类ID",
                maxlength: "商品分类ID不能多余32个字符"
        },
        catalogName: {
            required: "请填商品分类名称",
                maxlength: "商品分类名称不能多余32个字符"
        },
        price: {
            required: "请填价格",
                maxlength: "价格不能多余32个字符"
        },
        number: {
            required: "请填数量",
                maxlength: "数量不能多余32个字符"
        },
        description: {
            required: "请填商品描述",
                maxlength: "商品描述不能多余32个字符"
        },
        picture: {
            required: "请填图片名称",
                maxlength: "图片名称不能多余32个字符"
        },
        releaseTime: {
            required: "请填上架时间",
                maxlength: "上架时间不能多余32个字符"
        },
    },
    highlight: function (e) {
        $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
    },
    success: function (e) {
        $(e).closest('.form-group').removeClass('has-error');//.addClass('has-info');
        $(e).remove();
    },
    errorPlacement: function (error, element) {
        element.closest("div.form-group").append(error);
    }
});
});

function getdata(){
	 datatable.fnPageChange("first", true);
}

function deletes(target){
    var ids = [];
    if(target){
        ids.push(datatable.fnGetData($(target).closest('tr')).id);
    }else{
        $.each(datatable.getSelectedData(), function(i, n){
            ids.push(n.id);
        });
    }

    if(ids.length==0){
        toastr.error("请选择一条记录！");
        return;
    }

    if(confirm("确定删除该记录吗？")) {
    	jQuery.ajax({
            type:"post",
            contentType: 'application/json',
            url:"[[@{/}]]tran/Products/deletes.html",
            data:JSON.stringify(ids),
            dataType: "json",
            success:function(data){
            	getdata();
                toastr.success("操作成功");
            }
        });
    }

}

function editRecord(target) {
    var data = datatable.fnGetData($(target).closest('tr'));
    showModal(data);
}


function exportTable() {
    var form = $("<form id='exportFile'>");
    form.attr('style', 'display:none');
    form.attr('target', '');
    form.attr('method', 'post');
    form.attr('action', '[[@{/}]]tran/Products/export.html');
    $('body').append(form);
    form.submit();
    form.remove();
}


function showModal(data) {
    validator.resetForm();
    $('#validation-form input,#validation-form select').each(function () {

        if (data)
            $(this).val(data[$(this).attr("name")]);
        else
            $(this).val('');

    });
    $('#modal-form').modal({'backdrop': 'static'});
    $(".chosen-select").trigger("chosen:updated");
}

function save(target) {
    if ($('#validation-form').valid()) {
        $(target).attr("disabled", "disabled");
        var op = $("#id").val() == '' ? "insert" : "update";
        jQuery.ajax({
            type: "post",
            url: "[[@{/}]]tran/Products/"+op+".html",
            data: $('#validation-form').serialize(),
            dataType: "json",
            success: function (data) {
                if (data.flag == "fail") {
                    $(target).removeAttr("disabled");
                    toastr.error(data.message);
                } else {
                    toastr.success("操作成功", function () {
                        $('#modal-form').modal('hide');
                        getdata();
                    });
                }
            }
        });
    }
}
</script>
<div class="footer"  th:include="/common/bottom::html"></div>    </div></div></body></html>